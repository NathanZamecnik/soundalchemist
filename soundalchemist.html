<head>
  <title>soundalchemist</title>
  <script type="text/javascript" src="/soundcloud.player.api.js">
  </script>
</head>

<body>
  {{> main}}
</body>

<template name="main">
  {{#if currentUser}}

  {{> loginButtons}} <!-- xcxc <p></p> didn't work here either! -->
  <br>
  <p></p>
  {{/if}}

  {{#if isLobby}}
  {{> lobby}}
  {{else}}
  {{> room}}
  {{/if}}
</template>

<template name="lobby">
  <p>
  Welcome to soundalchemist v0.002 or something! Anyone want to help me design this? avital@thewe.net; oh also <a href="https://github.com/avital/soundalchemist" target="_blank">on github</a>
  </p>

  <h2>
    A MUSICAL JOURNEY IN INFINITE-DIMENSIONAL SPACE
  </h2>


  {{#if currentUser}}
  <a id="newroom">new room</a>
  {{else}}
  {{> loginButtons}} to start a new room
  {{/if}}

  <hr />
  <h3>RECENTLY</h3>
  {{> recentActivity}}
</template>

<template name="recentActivity">
  {{#each list}}
  {{> raw-source-track}}
  {{/each}}
</template>

<template name="room">
  <a id="back-to-lobby">back to lobby</a>
  {{#if currentUser}}
  ~~~
  <a id="newroom">new room</a>
  <hr />

  {{/if}}
  {{> sources}}
  <hr />
  {{> recommendations}}
</template>

<template name="processing">
  {{#if processing}}<p>processing...</p>{{/if}}
</template>

<template name="sources">
  {{> processing}}
  {{#each list}}
  {{> source-track}}
  {{/each}}

  {{#if currentUser}}
  <input id="url"
         placeholder="e.g. http://soundcloud.com/russliquid/russ-liquid-soundcloud-mix"
         />
  <input id="add" type="button" value="lean towards" />
  {{else}}

  <br> <!-- xcxc why couldn't i put <p> here?! i got a liverange error -->
  {{> loginButtons}} to start a new room, fork this one or skip to more music like this
  {{/if}}

</template>

<template name="recommendations">
  <p>...AND NOW WE ARE HERE.</p>

  {{#each list}}
  {{> recommendation-track}}
  {{/each}}
</template>

<template name="source-track">
  <p id="source-track-{{trackId}}">
    {{whoName}}
    {{weightDescriptor}}
<!--    <a class="change_weight">change</a> -->
    <a href="{{url}}" target="_blank">{{url}}</a>
    {{#if currentUser}}
    ~~~ <a class="unmake-source">forget</a>
    {{/if}}
<!--    {{trackId}} -->
  </p>
</template>

<template name="raw-source-track">
  {{#if url}}
  <p id="source-track-{{trackId}}">
    {{whoName}}
    leaned towards
<!--    <a class="change_weight">change</a> -->
    <a href="{{url}}" target="_blank">{{url}}</a>
    in room
    <a href="/{{roomId}}">{{roomId}}</a>
<!--    {{trackId}} -->
  </p>
  {{/if}}
</template>

<template name="recommendation-track">
  <p>
<!--
    {{rank}}
    {{spectrum}}
-->
    {{#if currentUser}}
    {{> voting}}
    ~~~
    <a class="skip">skip</a>
    {{/if}}
    {{> outer_track}}
  </p>
</template>

<template name="voting">
  {{#if loaded}}
  <a class="upvote">lean towards this</a> ~~~
  <a class="downvote">lean away from this</a>
  {{/if}}
</template>

<template name="outer_track">
  {{> track}}
</template>

<template name="track">
  <iframe id="{{playerId}}" frameborder="no" height="166" scrolling="no"
          src="http://w.soundcloud.com/player/?url={{escapedUrl}}&auto_play=false&show_artwork=true&color=d31502"
          width="100%">
  </iframe>
</template>

